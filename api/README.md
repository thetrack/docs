# REST API

---

Thetrack API организовано в стиле REST. В API предусмотрены предсказуемые, ориентированные на ресурсы URL-адреса и использованы HTTP коды ответов для ошибок в запросах к API.

Мы используем стандарт HTTP/1.1 и его возможности такие как HTTP аутентификация и HTTP методы, которые будут понятны всем существующими HTTP-клиентами поддерживающим протокол HTTP/1.1.

Все ответы API возвращаются в формате JSON, в том числе, и ошибки.

## Аутентификация и авторизация

После регистрации вам будут выданы два ключа **публичный ключ** вида _pk\_UUID и _**секретный ключ **вида sk\_UUID. Эти ключи используются для дальнейшей аутентификации и авторизации в Thetrack. **Публичный ключ** используется в мобильных SDK и в клиентском коде. Права доступа по этому ключу не позволяют выполнять некоторые действия, например просматривать списки всех ваших задач или водителей. **Секретный ключ **используется для серверной интеграции и обладает неограниченными правами.

> **Внимание!!!**
>
> Нельзя использовать **секретный ключ** в общедоступном коде. Чтобы злоумышленники не могли прочитать и воспользоваться вашим ключом для доступа к вашим ресурсам.

Аутентификация в API происходит через HTTP Token Auth. Используйте ваши ключи API в качестве токена.

Все запросы к API должны производиться через протокол HTTPS. Вызовы через обычный протокол HTTP будут игнорироваться.

Для любых запросов вам необходима аутентификация.

```bash
# Вам нужно подставить корректный заголовок Authorization.
curl https://api.thetrack.io/v1/drivers/ \
   -H "Authorization: token sk_token" \
   -H "Content-Type: application/json"
```

## Формат запроса и ответа

Thetrack API поддерживает формат JSON, поэтому во время запроса убедитесь в корректности заголовка **Content-Type.**

```bash
curl https://api.thetrack.io/v1/drivers/ \
   -H "Authorization: token sk_token" \
   -H "Content-Type: application/json" \
   -X POST \
   -d @body.json
```

## Пагинация списков {#api-pagination}
Все запросы возвращающие списки объектов работают через пагинатор и возвращают строго определенное кол-во элементов.

Например запрос `GET https://api.thetrack.io/v1/drivers/` вернет
```javascript
{
    "count": 94,
    "next": "http://localhost:8000/api/v1/drivers/?page=2",
    "previous": null,
    "results": [
        {
            "id": "875f2517-def3-4951-be01-3402eac6ea4d",
            "active_tasks": [],
            "name": "Иван Диктирёв",
            "photo": null,
            "phone": "+71234567890",
            "vehicle_type": "car",
            "location": {
                "type": "Point",
                "coordinates": []
            },
            "lookup_id": "1232",
            "created": "2017-08-03T14:14:12.992602Z"
        },
        {
            "id": "a0cd9595-4ba8-45d2-b1d6-3e49ccf50c69",
            "active_tasks": [],
            "name": "Василий Лобанов",
            "photo": null,
            "phone": "+71234567890",
            "vehicle_type": "car",
            "location": {
                "type": "Point",
                "coordinates": [
                    37.58158653451538,
                    55.71143605680116
                ]
            },
            "lookup_id": "123",
            "created": "2017-07-28T10:25:14.912898Z"
        },
        ...
    ]
}
```
Объекты хранятся в поле results и для их получения вам нужно просто обратиться к данным этого поля. Все остальные поля являются служебными для пагинатора и их смысл описан в таблице представленной ниже.

### Поля
| Имя           | Описание      |
| ------------- | ------------- |
|**count** <br/> *Integer*|Суммарное количество элементов для данного запроса|
|**next** <br/> *String*|Ссылка на следующую страницу с элементами. Если поле не задано, значит текущая страница является последней|
|**previous** <br/> *String*|Предыдущая страница. Если поле не задано то текущая страница является первой.|
|**results** <br/> *Json*|Список объектов удовлетворяющих текущему запросу|

### Параметры
При запросе объектов можно в параметры GET запроса передавать дополнительные атрибуты.

| Имя           | Описание      |
| ------------- | ------------- |
|**page** <br/> *Integer*|Номер страницы, нумерация начинается с единицы|
|**page_size** <br/> *Integer*|Кол-во элементов выводимых за один запрос. Максимум 200. По умолчанию 50|

Например запрос `GET https://api.thetrack.io/v1/drivers/?page=3&page_size=100` Выведет третью страницу с 100 объектами в поле `results`.

